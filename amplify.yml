version: 1
env:
  variables:
    # Build-time environment variables
    NODE_ENV: production
    VITE_ENFORCE_HTTPS: "true"
    VITE_ENABLE_HSTS: "true"
    VITE_ENABLE_CSP: "true"
  # Branch-specific environment variables
  main:
    variables:
      VITE_CLERK_PUBLISHABLE_KEY: $VITE_CLERK_PUBLISHABLE_KEY
      VITE_API_BASE_URL: $VITE_API_BASE_URL
      VITE_DEBUG_MODE: "false"
      VITE_LOG_LEVEL: "warn"
  develop:
    variables:
      VITE_CLERK_PUBLISHABLE_KEY: $VITE_CLERK_PUBLISHABLE_KEY_DEV
      VITE_API_BASE_URL: $VITE_API_BASE_URL_DEV
      VITE_DEBUG_MODE: "true"
      VITE_LOG_LEVEL: "debug"
      
frontend:
  phases:
    preBuild:
      commands:
        - echo "Node.js before upgrade:" && node -v && npm -v
        - nvm install 20 || echo "NVM install failed, trying alternative"
        - nvm use 20 || echo "NVM use failed, continuing with current version"
        - echo "Node.js after upgrade:" && node -v && npm -v
        - npm install -g npm@latest || echo "npm upgrade failed"
        - npm ci --include=dev
    build:
      commands:
        - echo "Building for production..."
        - npm run build:production
  artifacts:
    baseDirectory: dist
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
      - .next/cache/**/*
